name: Laravel Migration Linter

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  lint-migrations:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ§¾ Checkout Package Repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 8.3
          extensions: mbstring, pdo, bcmath, curl, dom, xml
          tools: composer:v2

      - name: ðŸ§° Create Test Laravel Project
        run: |
          composer create-project laravel/laravel test-laravel-app
          cd test-laravel-app
          composer config repositories.sufyan path ../
          composer require sufyan/laravel-migration-linter:@dev --ignore-platform-reqs --no-interaction

      - name: ðŸ§© Run Migration Linter
        run: |
          cd test-laravel-app
          php artisan migrate:lint --json > lint-report.json

      - name: ðŸ“¦ Upload Lint Report (optional)
        uses: actions/upload-artifact@v4
        with:
          name: migration-lint-report
          path: test-laravel-app/lint-report.json
